<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ï¸ å°ç£é›»è²»è©¦ç®—å™¨ | Daily Taiwan Web Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <div class="max-w-2xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <a href="../../index.html" class="text-blue-600 hover:text-blue-800 font-bold flex items-center transition-colors">
                <span class="mr-1">ğŸ </span> å›é¦–é 
            </a>
            <h1 class="text-2xl font-bold text-slate-900">âš¡ï¸ å°ç£é›»è²»è©¦ç®—å™¨</h1>
        </div>

        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
            <!-- Form Section -->
            <div class="space-y-6">
                <!-- Usage Mode -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">è©¦ç®—æ–¹å¼</label>
                    <div class="grid grid-cols-2 gap-4">
                        <button id="mode-direct" class="py-2 px-4 rounded-lg border-2 border-blue-600 bg-blue-50 text-blue-700 font-bold transition-all">ç¸½ç”¨é›»åº¦æ•¸</button>
                        <button id="mode-diff" class="py-2 px-4 rounded-lg border-2 border-slate-200 text-slate-500 hover:bg-slate-50 transition-all">é›»è¡¨è®€æ•¸ç›¸æ¸›</button>
                    </div>
                </div>

                <!-- Input Section -->
                <div id="input-direct" class="block">
                    <label class="block text-sm font-medium text-slate-700 mb-1">æœ¬æœŸç¸½ç”¨é›»åº¦æ•¸ (kWh)</label>
                    <input type="number" id="usage-total" placeholder="ä¾‹å¦‚ï¼š500" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-lg">
                </div>

                <div id="input-diff" class="hidden space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">æœ¬æœŸé›»è¡¨è®€æ•¸</label>
                            <input type="number" id="meter-current" placeholder="æœ¬æœŸ" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">ä¸ŠæœŸé›»è¡¨è®€æ•¸</label>
                            <input type="number" id="meter-last" placeholder="ä¸ŠæœŸ" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Season Selection -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">å­£ç¯€é¸æ“‡</label>
                    <div class="flex items-center space-x-6">
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="season" value="summer" checked class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2">å¤æœˆ (6/1 - 9/30)</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="radio" name="season" value="non-summer" class="w-4 h-4 text-blue-600 focus:ring-blue-500">
                            <span class="ml-2">éå¤æœˆ</span>
                        </label>
                    </div>
                </div>

                <button id="calculate-btn" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all active:scale-[0.98]">
                    ç«‹å³è©¦ç®— ğŸš€
                </button>
            </div>

            <!-- Result Section -->
            <div id="result-container" class="hidden mt-10 pt-8 border-t border-slate-100">
                <div class="text-center mb-6">
                    <p class="text-slate-500 text-sm">é ä¼°æœ¬æœŸé›»è²» (éç‡Ÿæ¥­ä½å®…ç”¨)</p>
                    <h2 class="text-5xl font-black text-slate-900 mt-1">NT$ <span id="total-cost">0</span></h2>
                </div>

                <div class="bg-slate-50 rounded-xl p-4 space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-500">ç¸½ç”¨é›»åº¦æ•¸</span>
                        <span class="font-bold"><span id="res-usage">0</span> åº¦</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-slate-500">å¹³å‡å–®åƒ¹</span>
                        <span class="font-bold">NT$ <span id="avg-price">0</span> / åº¦</span>
                    </div>
                </div>

                <!-- Tier Details -->
                <div class="mt-6">
                    <h3 class="text-sm font-bold text-slate-700 mb-3">è¨ˆè²»ç´šè·æ˜ç´°</h3>
                    <div id="tier-list" class="space-y-2">
                        <!-- Dynamic tiers here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Note -->
        <div class="mt-8 text-center text-xs text-slate-400 space-y-1">
            <p>â€» æœ¬è©¦ç®—çµæœåƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›è²»ç”¨ä»¥å°é›»é›»è²»é€šçŸ¥å–®ç‚ºæº–ã€‚</p>
            <p>â€» è²»ç‡åƒè€ƒ 2024 å¹´ 10 æœˆå°é›»æœ€æ–°èª¿æ•´æ¨™æº– (éç‡Ÿæ¥­æ€§ä½å®…)ã€‚</p>
            <p class="pt-4">Created by AI Agent on 2026-01-31</p>
        </div>
    </div>

    <script>
        // Tiers data (2024 Oct Residential)
        const rates = {
            summer: [
                { limit: 120, rate: 1.63 },
                { limit: 330, rate: 2.38 },
                { limit: 500, rate: 3.52 },
                { limit: 700, rate: 4.80 },
                { limit: 1000, rate: 5.83 },
                { limit: Infinity, rate: 7.69 }
            ],
            nonSummer: [
                { limit: 120, rate: 1.63 },
                { limit: 330, rate: 2.10 },
                { limit: 500, rate: 2.89 },
                { limit: 700, rate: 3.94 },
                { limit: 1000, rate: 4.74 },
                { limit: Infinity, rate: 6.03 }
            ]
        };

        const modeDirect = document.getElementById('mode-direct');
        const modeDiff = document.getElementById('mode-diff');
        const inputDirect = document.getElementById('input-direct');
        const inputDiff = document.getElementById('input-diff');
        let currentMode = 'direct';

        modeDirect.onclick = () => {
            currentMode = 'direct';
            modeDirect.className = 'py-2 px-4 rounded-lg border-2 border-blue-600 bg-blue-50 text-blue-700 font-bold transition-all';
            modeDiff.className = 'py-2 px-4 rounded-lg border-2 border-slate-200 text-slate-500 hover:bg-slate-50 transition-all';
            inputDirect.classList.remove('hidden');
            inputDiff.classList.add('hidden');
        };

        modeDiff.onclick = () => {
            currentMode = 'diff';
            modeDiff.className = 'py-2 px-4 rounded-lg border-2 border-blue-600 bg-blue-50 text-blue-700 font-bold transition-all';
            modeDirect.className = 'py-2 px-4 rounded-lg border-2 border-slate-200 text-slate-500 hover:bg-slate-50 transition-all';
            inputDiff.classList.remove('hidden');
            inputDirect.classList.add('hidden');
        };

        document.getElementById('calculate-btn').onclick = () => {
            let usage = 0;
            if (currentMode === 'direct') {
                usage = parseFloat(document.getElementById('usage-total').value) || 0;
            } else {
                const current = parseFloat(document.getElementById('meter-current').value) || 0;
                const last = parseFloat(document.getElementById('meter-last').value) || 0;
                usage = Math.max(0, current - last);
            }

            const season = document.querySelector('input[name="season"]:checked').value;
            const activeRates = season === 'summer' ? rates.summer : rates.nonSummer;

            let totalCost = 0;
            let remainingUsage = usage;
            let lastLimit = 0;
            let tierBreakdown = [];

            for (const tier of activeRates) {
                const tierCapacity = tier.limit - lastLimit;
                const tierUsage = Math.min(remainingUsage, tierCapacity);
                
                if (tierUsage > 0) {
                    const cost = tierUsage * tier.rate;
                    totalCost += cost;
                    tierBreakdown.push({
                        range: lastLimit === 0 ? `120 åº¦ä»¥ä¸‹` : `${lastLimit + 1} - ${tier.limit === Infinity ? 'ä»¥ä¸Š' : tier.limit} åº¦`,
                        usage: tierUsage,
                        rate: tier.rate,
                        cost: cost
                    });
                    remainingUsage -= tierUsage;
                }
                lastLimit = tier.limit;
                if (remainingUsage <= 0) break;
            }

            // Display results
            document.getElementById('total-cost').innerText = Math.round(totalCost).toLocaleString();
            document.getElementById('res-usage').innerText = usage.toLocaleString();
            document.getElementById('avg-price').innerText = (usage > 0 ? (totalCost / usage).toFixed(2) : 0);

            const tierList = document.getElementById('tier-list');
            tierList.innerHTML = '';
            tierBreakdown.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center text-xs py-2 border-b border-slate-50';
                div.innerHTML = `
                    <div class="flex-grow">
                        <span class="text-slate-600 font-medium">${item.range}</span>
                        <span class="text-slate-400 ml-2">(${item.usage} åº¦ Ã— ${item.rate})</span>
                    </div>
                    <span class="font-bold text-slate-700">NT$ ${item.cost.toFixed(1)}</span>
                `;
                tierList.appendChild(div);
            });

            document.getElementById('result-container').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        };
    </script>
</body>
</html>
