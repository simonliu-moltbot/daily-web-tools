<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€„ï¸ å°ç£ 16 å¼µéº»å°‡å°æ•¸è¨ˆç®—å™¨ (å®˜æ–¹è¦å‰‡ç‰ˆ) | SimonLiu OpenClaw Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; background-color: #faf9f6; color: #44403c; }
        .glass-panel { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(231, 229, 228, 0.5); }
        .input-card { background: white; border-radius: 12px; border: 1px solid #e7e5e4; padding: 1.5rem; transition: all 0.2s; }
        .input-card:hover { border-color: #d6d3d1; box-shadow: 0 4px 12px rgba(0,0,0,0.02); }
        .btn-primary { background-color: #292524; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; font-weight: 500; transition: all 0.2s; }
        .btn-primary:hover { background-color: #44403c; transform: translateY(-1px); }
        .chip { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; border: 1px solid #e7e5e4; cursor: pointer; transition: all 0.2s; }
        .chip.active { background-color: #292524; color: white; border-color: #292524; }
        .section-title { font-size: 0.7rem; font-weight: 700; color: #a8a29e; text-transform: uppercase; letter-spacing: 0.15em; margin-bottom: 1.5rem; display: block; }
    </style>
</head>
<body class="min-h-screen flex flex-col p-4 sm:p-8">
    <header class="max-w-3xl mx-auto w-full mb-12 text-center">
        <a href="../../index.html" class="text-xs font-bold text-stone-400 hover:text-stone-900 transition-colors uppercase tracking-widest">&larr; Back to Tools</a>
        <h1 class="text-3xl font-light text-stone-900 mt-6 mb-2 tracking-tight">ğŸ€„ï¸ å°ç£ 16 å¼µéº»å°‡å°æ•¸è¨ˆç®—å™¨</h1>
        <p class="text-stone-500 font-light text-sm">åƒè€ƒã€Œä¸­è¯éº»å°‡ç«¶æŠ€å”æœƒã€æ¨™æº–è¨ˆå°è¦å‰‡</p>
    </header>

    <main class="max-w-3xl mx-auto w-full space-y-6">
        <!-- 1. åŸºç¤è¨­å®š -->
        <div class="input-card">
            <span class="section-title">1. åŸºç¤è¨­å®š</span>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
                <div>
                    <label class="block text-xs font-medium text-stone-400 mb-3 uppercase tracking-wider">åœˆé¢¨</label>
                    <div id="wind-round" class="flex gap-2">
                        <span class="chip active" onclick="setSelect('wind-round', 'æ±')">æ±</span>
                        <span class="chip" onclick="setSelect('wind-round', 'å—')">å—</span>
                        <span class="chip" onclick="setSelect('wind-round', 'è¥¿')">è¥¿</span>
                        <span class="chip" onclick="setSelect('wind-round', 'åŒ—')">åŒ—</span>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-stone-400 mb-3 uppercase tracking-wider">èƒ¡å®¶é–€é¢¨ (åº§ä½)</label>
                    <div id="wind-seat" class="flex gap-2">
                        <span class="chip active" onclick="setSelect('wind-seat', 'æ±')">æ±</span>
                        <span class="chip" onclick="setSelect('wind-seat', 'å—')">å—</span>
                        <span class="chip" onclick="setSelect('wind-seat', 'è¥¿')">è¥¿</span>
                        <span class="chip" onclick="setSelect('wind-seat', 'åŒ—')">åŒ—</span>
                    </div>
                </div>
            </div>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-8">
                <div>
                    <label class="block text-xs font-medium text-stone-400 mb-3 uppercase tracking-wider">èŠå®¶ç‹€æ…‹</label>
                    <div class="flex items-center gap-4">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="is-dealer" class="w-4 h-4 rounded border-gray-300 text-stone-900 focus:ring-stone-900" onchange="toggleDealerCount()">
                            <span class="ml-2 text-sm text-stone-600">æˆ‘æ˜¯èŠå®¶</span>
                        </label>
                        <select id="dealer-count" class="hidden text-sm border-none bg-stone-100 rounded px-2 py-1 outline-none">
                            <option value="0">é€£èŠ 0 (ç•¶èŠ)</option>
                            <option value="1">é€£ 1 æ‹‰ 1</option>
                            <option value="2">é€£ 2 æ‹‰ 2</option>
                            <option value="3">é€£ 3 æ‹‰ 3</option>
                            <option value="4">é€£ 4 æ‹‰ 4</option>
                            <option value="5">é€£ 5 ä»¥ä¸Š</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-medium text-stone-400 mb-3 uppercase tracking-wider">ç‰¹æ®ŠåŠ å°</label>
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="is-self-drawn" class="w-4 h-4 rounded border-gray-300 text-stone-900 focus:ring-stone-900">
                            <span class="ml-2 text-sm text-stone-600">è‡ªæ‘¸</span>
                        </label>
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="is-concealed" class="w-4 h-4 rounded border-gray-300 text-stone-900 focus:ring-stone-900">
                            <span class="ml-2 text-sm text-stone-600">é–€æ¸…</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. èŠ±ç‰Œ -->
        <div class="input-card">
            <span class="section-title">2. èŠ±ç‰Œ</span>
            <div id="flower-tiles" class="flex flex-wrap gap-2">
                <span class="chip" onclick="toggleChip(this)" data-val="f1">1 æ˜¥</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f2">2 å¤</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f3">3 ç§‹</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f4">4 å†¬</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f5">5 æ¢…</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f6">6 è˜­</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f7">7 ç«¹</span>
                <span class="chip" onclick="toggleChip(this)" data-val="f8">8 èŠ</span>
            </div>
        </div>

        <!-- 3. ç‰Œå‹çµ„æˆ -->
        <div class="input-card">
            <span class="section-title">3. ç‰Œå‹çµ„æˆ</span>
            <p class="text-[10px] text-stone-400 mb-4">è«‹è¼¸å…¥å„çµ„é¢å­èˆ‡å°‡ï¼Œä¾‹å¦‚ï¼šä¸­ä¸­ä¸­, 1m2m3m... (ç³»çµ±æœƒåµæ¸¬å°å­èˆ‡åˆ»å­)</p>
            <div class="space-y-4">
                <textarea id="hand-list" class="w-full h-32 p-4 bg-stone-50 border border-stone-200 rounded-lg text-sm focus:outline-none focus:ring-1 focus:ring-stone-400 transition-colors" placeholder="ä¾‹å¦‚ï¼šç´…ä¸­ç´…ä¸­ç´…ä¸­, 1è¬2è¬3è¬, 5æ¢5æ¢5æ¢, ç™¼è²¡ç™¼è²¡ç™¼è²¡, 1ç­’2ç­’3ç­’ + å°‡ï¼šç™½æ¿ç™½æ¿"></textarea>
            </div>
            
            <div class="mt-6">
                <label class="block text-xs font-medium text-stone-400 mb-3 uppercase tracking-wider">è½ç‰Œèˆ‡èƒ¡æ³•</label>
                <div class="flex flex-wrap gap-4">
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="wait-type" value="normal" checked class="w-4 h-4 text-stone-900">
                        <span class="ml-2 text-sm text-stone-600">ä¸€èˆ¬</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="radio" name="wait-type" value="edge" class="w-4 h-4 text-stone-900">
                        <span class="ml-2 text-sm text-stone-600">é‚Šå¼µ/åµŒå¼µ/å–®åŠ (+1)</span>
                    </label>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="is-robbing-kong" class="w-4 h-4 text-stone-900">
                        <span class="ml-2 text-sm text-stone-600">æ¶æ§“ (+1)</span>
                    </label>
                </div>
            </div>
        </div>

        <button onclick="calculate()" class="w-full btn-primary text-sm tracking-widest uppercase shadow-lg">è¨ˆç®—å°æ•¸</button>

        <!-- Result -->
        <div id="result-area" class="hidden glass-panel rounded-xl p-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
            <div class="text-center mb-8">
                <span class="text-xs font-bold text-stone-400 uppercase tracking-widest">ç¸½è¨ˆå°æ•¸</span>
                <div id="total-tai" class="text-6xl font-light text-stone-900 mt-2">0</div>
            </div>
            <div id="reasons" class="space-y-3 border-t border-stone-100 pt-6">
                <!-- Reasons injected here -->
            </div>
        </div>

        <footer class="py-12 text-center">
            <p class="text-[10px] text-stone-300 uppercase tracking-widest">åƒè€ƒ ä¸­è¯éº»å°‡ç«¶æŠ€å”æœƒ è¦ç¯„è£½ä½œ</p>
        </footer>
    </main>

    <script>
        function setSelect(id, val) {
            const container = document.getElementById(id);
            container.querySelectorAll('.chip').forEach(c => {
                c.classList.toggle('active', c.innerText === val);
            });
        }

        function toggleChip(el) {
            el.classList.toggle('active');
        }

        function toggleDealerCount() {
            const isDealer = document.getElementById('is-dealer').checked;
            document.getElementById('dealer-count').classList.toggle('hidden', !isDealer);
        }

        function calculate() {
            const windRound = document.querySelector('#wind-round .active').innerText;
            const windSeat = document.querySelector('#wind-seat .active').innerText;
            const isDealer = document.getElementById('is-dealer').checked;
            const dealerCount = parseInt(document.getElementById('dealer-count').value);
            const isSelfDrawn = document.getElementById('is-self-drawn').checked;
            const isConcealed = document.getElementById('is-concealed').checked;
            const flowers = Array.from(document.querySelectorAll('#flower-tiles .active')).map(el => el.dataset.val);
            const handRaw = document.getElementById('hand-list').value;
            const waitType = document.querySelector('input[name="wait-type"]:checked').value;
            const isRobbingKong = document.getElementById('is-robbing-kong').checked;

            let totalTai = 0;
            let reasons = [];

            // 1. èŠå®¶ç›¸é—œ
            if (isDealer) {
                totalTai += 1;
                reasons.push("èŠå®¶ (+1)");
                if (dealerCount > 0) {
                    const t = dealerCount * 2;
                    totalTai += t;
                    reasons.push(`é€£ ${dealerCount} æ‹‰ ${dealerCount} (+${t})`);
                }
            }

            // 2. èƒ¡æ³•ç›¸é—œ
            if (isSelfDrawn) {
                if (isConcealed) {
                    totalTai += 3; // é–€æ¸…è‡ªæ‘¸ = é–€æ¸…(1) + è‡ªæ‘¸(1) + é–€æ¸…è‡ªæ‘¸(1) = 3å°
                    reasons.push("é–€æ¸…è‡ªæ‘¸ (+3)");
                } else {
                    totalTai += 1;
                    reasons.push("è‡ªæ‘¸ (+1)");
                }
            } else if (isConcealed) {
                totalTai += 1;
                reasons.push("é–€æ¸… (+1)");
            }

            if (waitType === 'edge') { totalTai += 1; reasons.push("é‚Š/åµŒ/ç¨è½ (+1)"); }
            if (isRobbingKong) { totalTai += 1; reasons.push("æ¶æ§“ (+1)"); }

            // 3. èŠ±ç‰Œ
            const seatToFlowers = {'æ±': ['f1', 'f5'], 'å—': ['f2', 'f6'], 'è¥¿': ['f3', 'f7'], 'åŒ—': ['f4', 'f8']};
            const correctFlowers = seatToFlowers[windSeat] || [];
            flowers.forEach(f => {
                if (correctFlowers.includes(f)) {
                    totalTai += 1;
                    reasons.push(`æ­£èŠ± (+1)`);
                }
            });
            if (flowers.length === 8) { totalTai += 8; reasons.push("å…«ä»™éæµ· (+8)"); }
            else if (flowers.length === 7) { totalTai += 8; reasons.push("ä¸ƒæ¶ä¸€ (+8)"); }

            // 4. å­—ç‰Œåˆ¤å®š (å¤§ä¸‰å…ƒ/å°ä¸‰å…ƒ)
            const hasZhong = (handRaw.match(/ä¸­/g) || []).length >= 3;
            const hasFa = (handRaw.match(/ç™¼/g) || []).length >= 3;
            const hasBai = (handRaw.match(/ç™½/g) || []).length >= 3;
            
            let dragonTriplets = 0;
            if (hasZhong) dragonTriplets++;
            if (hasFa) dragonTriplets++;
            if (hasBai) dragonTriplets++;

            if (dragonTriplets === 3) {
                totalTai += 8;
                reasons.push("å¤§ä¸‰å…ƒ (+8)");
            } else if (dragonTriplets === 2) {
                const eyeZhong = (handRaw.match(/ä¸­/g) || []).length === 2;
                const eyeFa = (handRaw.match(/ç™¼/g) || []).length === 2;
                const eyeBai = (handRaw.match(/ç™½/g) || []).length === 2;
                if ((!hasZhong && eyeZhong) || (!hasFa && eyeFa) || (!hasBai && eyeBai)) {
                    totalTai += 4;
                    reasons.push("å°ä¸‰å…ƒ (+4)");
                } else {
                    if (hasZhong) { totalTai += 1; reasons.push("ç´…ä¸­ (+1)"); }
                    if (hasFa) { totalTai += 1; reasons.push("ç™¼è²¡ (+1)"); }
                    if (hasBai) { totalTai += 1; reasons.push("ç™½æ¿ (+1)"); }
                }
            } else {
                if (hasZhong) { totalTai += 1; reasons.push("ç´…ä¸­ (+1)"); }
                if (hasFa) { totalTai += 1; reasons.push("ç™¼è²¡ (+1)"); }
                if (hasBai) { totalTai += 1; reasons.push("ç™½æ¿ (+1)"); }
            }
            
            // å››å–œåˆ¤å®š
            const hasEast = (handRaw.match(/æ±/g) || []).length >= 3;
            const hasSouth = (handRaw.match(/å—/g) || []).length >= 3;
            const hasWest = (handRaw.match(/è¥¿/g) || []).length >= 3;
            const hasNorth = (handRaw.match(/åŒ—/g) || []).length >= 3;
            let windTriplets = [hasEast, hasSouth, hasWest, hasNorth].filter(Boolean).length;
            
            if (windTriplets === 4) {
                totalTai += 16;
                reasons.push("å¤§å››å–œ (+16)");
            } else if (windTriplets === 3) {
                const eyeEast = (handRaw.match(/æ±/g) || []).length === 2;
                const eyeSouth = (handRaw.match(/å—/g) || []).length === 2;
                const eyeWest = (handRaw.match(/è¥¿/g) || []).length === 2;
                const eyeNorth = (handRaw.match(/åŒ—/g) || []).length === 2;
                if ((!hasEast && eyeEast) || (!hasSouth && eyeSouth) || (!hasWest && eyeWest) || (!hasNorth && eyeNorth)) {
                    totalTai += 8;
                    reasons.push("å°å››å–œ (+8)");
                }
            }
            
            // åœˆé¢¨é–€é¢¨ (è‹¥å·²è¨ˆå…¥å››å–œå‰‡ä¸é‡è¤‡è¨ˆ)
            if (windTriplets < 3) {
                if ((handRaw.match(new RegExp(windRound, 'g')) || []).length >= 3) { totalTai += 1; reasons.push(`åœˆé¢¨ ${windRound} (+1)`); }
                if ((handRaw.match(new RegExp(windSeat, 'g')) || []).length >= 3) { totalTai += 1; reasons.push(`é–€é¢¨ ${windSeat} (+1)`); }
            }

            // 5. ç‰Œå‹åˆ¤å®š (æ¸…ä¸€è‰² / æ¹Šä¸€è‰² / å­—ä¸€è‰²)
            const hasWan = /[è¬m]/.test(handRaw);
            const hasTiao = /[æ¢s]/.test(handRaw);
            const hasTong = /[ç­’p]/.test(handRaw);
            const hasZi = /[ä¸­ç™¼ç™½æ±è¥¿å—åŒ—]/.test(handRaw);
            const suitCount = [hasWan, hasTiao, hasTong].filter(Boolean).length;

            if (suitCount === 1 && !hasZi) {
                totalTai += 8;
                reasons.push("æ¸…ä¸€è‰² (+8)");
            } else if (suitCount === 1 && hasZi) {
                totalTai += 2;
                reasons.push("æ¹Šä¸€è‰² (+2)");
            } else if (suitCount === 0 && hasZi) {
                totalTai += 16;
                reasons.push("å­—ä¸€è‰² (+16)");
            }

            // 6. ç¢°ç¢°èƒ¡ (ç°¡å–®åµæ¸¬ 5 çµ„åˆ»å­)
            const triplets = (handRaw.match(/.../g) || []).filter(s => s[0] === s[1] && s[1] === s[2]).length;
            if (triplets >= 5) {
                totalTai += 4;
                reasons.push("ç¢°ç¢°èƒ¡ (+4)");
            }

            // å±•ç¤ºçµæœ
            document.getElementById('total-tai').innerText = totalTai;
            const reasonsList = document.getElementById('reasons');
            reasonsList.innerHTML = reasons.length ? reasons.map(r => `
                <div class="flex justify-between items-center text-sm py-1 border-b border-stone-50 last:border-none">
                    <span class="text-stone-600">${r.split(' (')[0]}</span>
                    <span class="font-mono text-stone-900 font-bold">${r.match(/\+\d+/)?.[0] || '+1'}</span>
                </div>
            `).join('') : '<div class="text-center text-stone-300 text-xs">ç„¡åŠ å°</div>';
            
            document.getElementById('result-area').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
