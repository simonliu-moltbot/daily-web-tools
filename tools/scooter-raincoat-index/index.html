<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ›µ æ©Ÿè»Šæ—é›¨è¡£æŒ‡æ•¸ | Scooter Raincoat Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-md mx-auto">
        <a href="../../index.html" class="inline-flex items-center text-gray-600 hover:text-gray-900 mb-6 transition-colors">
            <span class="mr-2">ğŸ </span> å›é¦–é 
        </a>

        <div class="card p-6 text-center">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">ğŸ›µ æ©Ÿè»Šæ—é›¨è¡£æŒ‡æ•¸</h1>
            <p class="text-gray-500 text-sm mb-6">æ ¹æ“šå³æ™‚é™é›¨æ©Ÿç‡ï¼Œæ±ºå®šä½ çš„è‘—è£ç­–ç•¥</p>

            <div id="loading" class="py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                <p class="mt-4 text-gray-400">æ­£åœ¨åµæ¸¬ä½ç½®èˆ‡å¤©æ°£...</p>
            </div>

            <div id="result" class="hidden">
                <div id="index-emoji" class="text-7xl mb-4">â˜€ï¸</div>
                <div id="index-level" class="text-3xl font-black mb-2">å®‰å…¨ç„¡æ†‚</div>
                <div id="weather-info" class="text-gray-600 mb-6">
                    <span id="location">å°åŒ—å¸‚</span> Â· <span id="temp">25Â°C</span><br>
                    é™é›¨æ©Ÿç‡ï¼š<span id="pop">0%</span>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 text-left mb-6">
                    <h3 class="font-bold text-gray-700 mb-1">ğŸ’¡ å»ºè­°ç­–ç•¥ï¼š</h3>
                    <p id="advice" class="text-gray-600">ç›®å‰å¤©æ°£æ™´æœ—ï¼Œæ”¾å¿ƒé¨è»Šå§ï¼ä½†è¨˜å¾—é˜²æ›¬ã€‚</p>
                </div>

                <div class="space-y-3">
                    <div class="flex items-center justify-between text-sm p-3 border rounded-lg" id="gear-suit">
                        <span>å…©æˆªå¼é›¨è¡£ (Suit)</span>
                        <span id="gear-suit-status">âŒ ä¸å»ºè­°</span>
                    </div>
                    <div class="flex items-center justify-between text-sm p-3 border rounded-lg" id="gear-poncho">
                        <span>å°é£›ä¿ æŠ«è‚©é›¨è¡£ (Poncho)</span>
                        <span id="gear-poncho-status">âŒ ä¸å»ºè­°</span>
                    </div>
                    <div id="gear-warning" class="text-xs text-red-500 font-medium hidden">âš ï¸ æ³¨æ„ï¼šå¼·é¢¨æ™‚è«‹ç©¿å…©æˆªå¼é›¨è¡£é¿å…å±éšªï¼</div>
                </div>
            </div>

            <button onclick="fetchWeather()" class="mt-8 w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors">
                ğŸ”„ é‡æ–°æ•´ç†
            </button>
        </div>

        <footer class="mt-12 text-center text-gray-400 text-xs">
            <p>æ•¸æ“šä¾†æºï¼šOpen-Meteo (CWA è§€æ¸¬æ•¸æ“šåƒè€ƒ)</p>
            <p class="mt-1">Created by AI Agent on 2026-02-03</p>
        </footer>
    </div>

    <script>
        async function fetchWeather() {
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            loading.classList.remove('hidden');
            result.classList.add('hidden');

            try {
                // Default to Taipei
                let lat = 25.0330, lon = 121.5654;
                
                if (navigator.geolocation) {
                    const pos = await new Promise((res, rej) => {
                        navigator.geolocation.getCurrentPosition(res, rej, { timeout: 5000 });
                    }).catch(() => null);
                    if (pos) {
                        lat = pos.coords.latitude;
                        lon = pos.coords.longitude;
                    }
                }

                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=precipitation_probability_max&current_weather=true&timezone=Asia%2FTaipei`);
                const data = await res.json();
                
                const temp = data.current_weather.temperature;
                const pop = data.daily.precipitation_probability_max[0];
                const wind = data.current_weather.windspeed;

                updateUI(temp, pop, wind);
            } catch (err) {
                console.error(err);
                alert('ç„¡æ³•å–å¾—å¤©æ°£æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šã€‚');
            } finally {
                loading.classList.add('hidden');
                result.classList.remove('hidden');
            }
        }

        function updateUI(temp, pop, wind) {
            document.getElementById('temp').textContent = `${temp}Â°C`;
            document.getElementById('pop').textContent = `${pop}%`;

            const emoji = document.getElementById('index-emoji');
            const level = document.getElementById('index-level');
            const advice = document.getElementById('advice');
            const gearSuit = document.getElementById('gear-suit-status');
            const gearPoncho = document.getElementById('gear-poncho-status');
            const warning = document.getElementById('gear-warning');

            warning.classList.add('hidden');

            if (pop < 20) {
                emoji.textContent = 'â˜€ï¸';
                level.textContent = 'å®‰å…¨ç„¡æ†‚';
                level.className = 'text-3xl font-black mb-2 text-green-500';
                advice.textContent = 'ç›®å‰é™é›¨æ©Ÿç‡æ¥µä½ï¼Œæ”¾å¿ƒé¨è»Šã€‚å¤©æ°£ä¸éŒ¯ï¼Œæ³¨æ„è·¯é¢ä¸‰å¯¶ã€‚';
                gearSuit.textContent = 'âŒ ç©¿äº†æœƒä¸­æš‘';
                gearPoncho.textContent = 'âŒ ä¸éœ€è¦';
            } else if (pop < 50) {
                emoji.textContent = 'â˜ï¸';
                level.textContent = 'å‚™æˆ°ç‹€æ…‹';
                level.className = 'text-3xl font-black mb-2 text-yellow-500';
                advice.textContent = 'å¯èƒ½æœ‰é›¶æ˜Ÿé™é›¨ã€‚å»ºè­°è»Šå»‚å…§å‚™å¦¥é›¨è¡£ï¼Œé¿å…çªç„¶è¢«ã€Œå·è¥²ã€ã€‚';
                gearSuit.textContent = 'âŒ› è»Šå»‚å¾…å‘½';
                gearPoncho.textContent = 'âœ… å»ºè­°æ”œå¸¶';
            } else if (pop < 80) {
                emoji.textContent = 'ğŸŒ¦ï¸';
                level.textContent = 'é›¨è¡£å¿…å‚™';
                level.className = 'text-3xl font-black mb-2 text-orange-500';
                advice.textContent = 'ä¸‹é›¨æ©Ÿç‡å¾ˆé«˜ï¼å‡ºç™¼å‰ç›´æ¥ç©¿ä¸Šå§ï¼Œä¸è¦è³­é‚£ 30% çš„é‹æ°£ã€‚';
                gearSuit.textContent = 'âœ… æ¨è–¦ä½¿ç”¨';
                gearPoncho.textContent = 'âœ… å ªç”¨';
            } else {
                emoji.textContent = 'ğŸŒ§ï¸';
                level.textContent = 'å…¨é¢æ­¦è£';
                level.className = 'text-3xl font-black mb-2 text-red-600';
                advice.textContent = 'å¤§é›¨è­¦æˆ’ï¼å¼·çƒˆå»ºè­°ç©¿å…©æˆªå¼é›¨è¡£ï¼Œé˜²æ°´æ€§èˆ‡å®‰å…¨æ€§è¼ƒä½³ã€‚';
                gearSuit.textContent = 'ğŸ† å”¯ä¸€é¦–é¸';
                gearPoncho.textContent = 'âš ï¸ å®¹æ˜“é€²æ°´';
            }

            if (wind > 30) {
                warning.classList.remove('hidden');
                warning.textContent = `âš ï¸ ç•¶å‰é¢¨é€Ÿè¼ƒå¤§ (${wind}km/h)ï¼Œç©¿æŠ«è‚©é›¨è¡£æ˜“é£„èµ·é®æ“‹è¦–ç·šï¼Œæ¥µåº¦å±éšªï¼`;
            }
        }

        fetchWeather();
    </script>
</body>
</html>
